"use strict";(self.webpackChunkwhoopsunix_wiki=self.webpackChunkwhoopsunix_wiki||[]).push([[576],{12184:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var s=c(85893),t=c(11151);const o={sidebar_position:1,tags:["ysoserial","PPPYSO","C3P0"]},i="C3P0",r={id:"PPPYSO/gadgets/C3P0/C3P0",title:"C3P0",description:"C3P0\uff08Connection Pool 3.0\uff09\u662f\u4e00\u4e2a\u7528\u4e8e\u7ba1\u7406\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u7684\u5f00\u6e90 Java \u5e93\uff0c\u5b9e\u73b0\u4e86\u6570\u636e\u6e90\u548c JNDI \u7ed1\u5b9a\uff0c\u652f\u6301 JDBC3 \u89c4\u8303\u548c JDBC2 \u7684\u62d3\u5c55\uff0c\u5728\u5f88\u591a\u5f00\u6e90\u9879\u76ee\u4e2d\u90fd\u4f7f\u7528\u5230\u3002",source:"@site/docs/01-PPPYSO/01-gadgets/08-C3P0/08-C3P0.md",sourceDirName:"01-PPPYSO/01-gadgets/08-C3P0",slug:"/PPPYSO/gadgets/C3P0/",permalink:"/docs/PPPYSO/gadgets/C3P0/",draft:!1,unlisted:!1,editUrl:"https://github.com/Whoopsunix/whoopsunix.github.io/docs/01-PPPYSO/01-gadgets/08-C3P0/08-C3P0.md",tags:[{label:"ysoserial",permalink:"/docs/tags/ysoserial"},{label:"PPPYSO",permalink:"/docs/tags/pppyso"},{label:"C3P0",permalink:"/docs/tags/c-3-p-0"}],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,tags:["ysoserial","PPPYSO","C3P0"]},sidebar:"tutorialSidebar",previous:{title:"JSON",permalink:"/docs/PPPYSO/gadgets/JSON/"},next:{title:"Jython",permalink:"/docs/PPPYSO/gadgets/Jython/"}},a={},d=[];function l(e){const n={code:"code",h1:"h1",img:"img",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"c3p0",children:"C3P0"}),"\n",(0,s.jsx)(n.p,{children:"C3P0\uff08Connection Pool 3.0\uff09\u662f\u4e00\u4e2a\u7528\u4e8e\u7ba1\u7406\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u7684\u5f00\u6e90 Java \u5e93\uff0c\u5b9e\u73b0\u4e86\u6570\u636e\u6e90\u548c JNDI \u7ed1\u5b9a\uff0c\u652f\u6301 JDBC3 \u89c4\u8303\u548c JDBC2 \u7684\u62d3\u5c55\uff0c\u5728\u5f88\u591a\u5f00\u6e90\u9879\u76ee\u4e2d\u90fd\u4f7f\u7528\u5230\u3002"}),"\n",(0,s.jsx)(n.h1,{id:"0x01-\u539f\u59cb\u8c03\u7528\u94fe\u5206\u6790",children:"0x01 \u539f\u59cb\u8c03\u7528\u94fe\u5206\u6790"}),"\n",(0,s.jsxs)(n.p,{children:["\u5148\u770b\u770b ",(0,s.jsx)(n.code,{children:"com.mchange.v2.c3p0.impl.PoolBackedDataSourceBase"})," \u7c7b\u7684 ",(0,s.jsx)(n.code,{children:"writeObject()"})," \u65b9\u6cd5\uff0c\u5728\u5e8f\u5217\u5316\u65f6\uff0c\u4f1a\u5c1d\u8bd5\u5e8f\u5217\u5316\u53d8\u91cf ",(0,s.jsx)(n.code,{children:"connectionPoolDataSource"})," \uff0c\u5982\u679c ",(0,s.jsx)(n.code,{children:"connectionPoolDataSource"})," \u662f\u4e0d\u53ef\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\uff0c\u5219\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"ReferenceIndirector.indirectForm()"})," \u8fdb\u884c\u5c01\u88c5\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231106101402067",src:c(37956).Z+"",width:"2052",height:"996"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8ddf\u8fdb ",(0,s.jsx)(n.code,{children:"indirectForm()"})," \u65b9\u6cd5\uff0c\u4f1a\u8c03\u7528 ",(0,s.jsx)(n.code,{children:"javax.naming.Referenceable#getReference()"})," \u8fd4\u56de\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"Reference"})," \u5bf9\u8c61\uff0c\u5e76\u7528 ",(0,s.jsx)(n.code,{children:"ReferenceSerialized"})," \u5c01\u88c5\u540e\u8fd4\u56de"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231106101615297",src:c(70497).Z+"",width:"1838",height:"212"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u53cd\u5e8f\u5217\u5316\u65f6\u91cd\u65b0\u751f\u6210 ",(0,s.jsx)(n.code,{children:"ConnectionPoolDataSource"})," \u5bf9\u8c61\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231106102001086",src:c(59374).Z+"",width:"2040",height:"612"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8ddf\u8fdb ",(0,s.jsx)(n.code,{children:"getObject()"})," \u65b9\u6cd5\uff0c\u8c03\u7528 ",(0,s.jsx)(n.code,{children:"javax.naming.Context.lookup()"})," \u901a\u8fc7 JNDI \u83b7\u53d6\u5bf9\u8c61\u3002\u5f53 env\u3001contextName \u4e3a null \u65f6\u5219\u4f1a\u8c03\u7528 ",(0,s.jsx)(n.code,{children:"com.mchange.v2.naming.ReferenceableUtils.referenceToObject()"})," \u52a0\u8f7d\u8fdc\u7a0b\u5bf9\u8c61"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231106102200869",src:c(3952).Z+"",width:"2044",height:"1114"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"referenceToObject()"})," \u65b9\u6cd5\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684 URLClassLoader \u52a0\u8f7d\u8fdc\u7a0b\u5bf9\u8c61\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231106102705653",src:c(50897).Z+"",width:"1974",height:"1036"})}),"\n",(0,s.jsxs)(n.p,{children:["\u6240\u4ee5\u8fd9\u4e2a\u8c03\u7528\u94fe\u7684\u6784\u9020\u5c31\u5f88\u7b80\u5355\u4e86\uff0c\u6784\u9020\u4e00\u4e2a\u5e26\u6709\u6076\u610f\u5229\u7528\u7684 ",(0,s.jsx)(n.code,{children:"ConnectionPoolDataSource"})," \u5bf9\u8c61\uff0c\u901a\u8fc7\u8fdc\u7a0b\u52a0\u8f7d\u5b9e\u73b0\u5229\u7528\u3002\u8fd9\u4e2a\u5730\u65b9\u7684 contextName \u6ca1\u6cd5\u63a7\u5236\uff0c\u6240\u4ee5\u4e0d\u80fd\u901a\u8fc7 lookup \u5b9e\u73b0 JNDI \u6ce8\u5165\u3002"]}),"\n",(0,s.jsx)(n.h1,{id:"0x02-orgapachenamingfactorybeanfactory",children:"0x02 org.apache.naming.factory.BeanFactory"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728 ",(0,s.jsx)(n.code,{children:"org.apache.naming.factory.BeanFactory.getObjectInstance()"})," \u65b9\u6cd5\u4e2d\uff0c\u8fd8\u53ef\u4ee5\u53cd\u5c04\u8c03\u7528\u65b9\u6cd5\uff0c\u53d8\u52a8\u4e00\u4e0b ",(0,s.jsx)(n.code,{children:"getReference()"})," \u65b9\u6cd5\u5c31\u53ef\u4ee5\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"javax.el.ELProcessor"})," \u5b9e\u73b0 EL \u8868\u8fbe\u5f0f\u6ce8\u5165\uff0c\u5177\u4f53\u89c1\u9879\u76ee\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20240308090453810",src:c(59610).Z+"",width:"1262",height:"426"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'public Reference getReference() throws NamingException {\n    String s = RanDomUtils.generateRandomString(3);\n    ResourceRef resourceRef = new ResourceRef("javax.el.ELProcessor", null, "", "", true, "org.apache.naming.factory.BeanFactory", null);\n    resourceRef.add(new StringRefAddr("forceString", s + "=eval"));\n\n    resourceRef.add(new StringRefAddr("a", String.format("Runtime.getRuntime().exec(\\"%s\\")", script)));\n\n    return resourceRef;\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u9664\u4e86 EL\u3001Groovy\u3001SnakeYaml \u7b49\u4e5f\u53ef\u4ee5\u89e6\u53d1\u3002"})]})}function g(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},37956:(e,n,c)=>{c.d(n,{Z:()=>s});const s=c.p+"assets/images/image-20231106101402067-3d76fd22c761e50481dcd45fe2aee9d2.png"},70497:(e,n,c)=>{c.d(n,{Z:()=>s});const s=c.p+"assets/images/image-20231106101615297-6cba254fe229233f62aca3d098ded745.png"},59374:(e,n,c)=>{c.d(n,{Z:()=>s});const s=c.p+"assets/images/image-20231106102001086-8210d513656b3bfbef3473f82c74b812.png"},3952:(e,n,c)=>{c.d(n,{Z:()=>s});const s=c.p+"assets/images/image-20231106102200869-d53ee078c3f16a1d90373f66456d303a.png"},50897:(e,n,c)=>{c.d(n,{Z:()=>s});const s=c.p+"assets/images/image-20231106102705653-f9ff67eefa90672f8ce8859756f86cd8.png"},59610:(e,n,c)=>{c.d(n,{Z:()=>s});const s=c.p+"assets/images/image-20240308090453810-345fcf8405e06e0b0f2974697df9d955.png"},11151:(e,n,c)=>{c.d(n,{Z:()=>r,a:()=>i});var s=c(67294);const t={},o=s.createContext(t);function i(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);