"use strict";(self.webpackChunkwhoopsunix_wiki=self.webpackChunkwhoopsunix_wiki||[]).push([[9249],{86611:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>o,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var r=s(85893),i=s(11151);const a={sidebar_position:1,tags:["ysoserial","PPPYSO","BeanShell"]},t="BeanShell",l={id:"PPPYSO/gadgets/Beanshell/Beanshell",title:"BeanShell",description:"BeanShell\u662f\u4e00\u4e2a\u5c0f\u578b\u7684\uff0c\u514d\u8d39\u7684\uff0c\u53ef\u5d4c\u5165\u7684Java\u6e90\u4ee3\u7801\u89e3\u91ca\u5668\uff0c\u5177\u6709\u5bf9\u8c61\u811a\u672c\u8bed\u8a00\u529f\u80fd\uff0c\u7528Java\u7f16\u5199\u3002BeanShell\u52a8\u6001\u5730\u6267\u884c\u6807\u51c6Java\u8bed\u6cd5\uff0c\u5e76\u4f7f\u7528\u5e38\u89c1\u7684\u811a\u672c\u4fbf\u5229\uff08\u5982Perl\u548cJavaScript\u4e2d\u7684\u677e\u6563\u7c7b\u578b\u3001\u547d\u4ee4\u548c\u65b9\u6cd5\u95ed\u5305\uff09\u5bf9\u5176\u8fdb\u884c\u6269\u5c55\u3002",source:"@site/docs/01-PPPYSO/01-gadgets/11-Beanshell/11-Beanshell.md",sourceDirName:"01-PPPYSO/01-gadgets/11-Beanshell",slug:"/PPPYSO/gadgets/Beanshell/",permalink:"/docs/PPPYSO/gadgets/Beanshell/",draft:!1,unlisted:!1,editUrl:"https://github.com/Whoopsunix/whoopsunix.github.io/docs/01-PPPYSO/01-gadgets/11-Beanshell/11-Beanshell.md",tags:[{label:"ysoserial",permalink:"/docs/tags/ysoserial"},{label:"PPPYSO",permalink:"/docs/tags/pppyso"},{label:"BeanShell",permalink:"/docs/tags/bean-shell"}],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,tags:["ysoserial","PPPYSO","BeanShell"]},sidebar:"tutorialSidebar",previous:{title:"Spring",permalink:"/docs/PPPYSO/gadgets/Spring/"},next:{title:"Groovy",permalink:"/docs/PPPYSO/gadgets/Groovy/"}},c={},d=[{value:"0x01 \u57fa\u672c\u4fe1\u606f",id:"0x01-\u57fa\u672c\u4fe1\u606f",level:2},{value:"bsh.Interpreter",id:"bshinterpreter",level:3},{value:"bsh.NameSpace",id:"bshnamespace",level:3},{value:"0x02 bsh.This",id:"0x02-bshthis",level:2},{value:"0x03 BeanShell1 user.dir \u6cc4\u9732",id:"0x03-beanshell1-userdir-\u6cc4\u9732",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"beanshell",children:"BeanShell"}),"\n",(0,r.jsx)(n.p,{children:"BeanShell\u662f\u4e00\u4e2a\u5c0f\u578b\u7684\uff0c\u514d\u8d39\u7684\uff0c\u53ef\u5d4c\u5165\u7684Java\u6e90\u4ee3\u7801\u89e3\u91ca\u5668\uff0c\u5177\u6709\u5bf9\u8c61\u811a\u672c\u8bed\u8a00\u529f\u80fd\uff0c\u7528Java\u7f16\u5199\u3002BeanShell\u52a8\u6001\u5730\u6267\u884c\u6807\u51c6Java\u8bed\u6cd5\uff0c\u5e76\u4f7f\u7528\u5e38\u89c1\u7684\u811a\u672c\u4fbf\u5229\uff08\u5982Perl\u548cJavaScript\u4e2d\u7684\u677e\u6563\u7c7b\u578b\u3001\u547d\u4ee4\u548c\u65b9\u6cd5\u95ed\u5305\uff09\u5bf9\u5176\u8fdb\u884c\u6269\u5c55\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"0x01-\u57fa\u672c\u4fe1\u606f",children:"0x01 \u57fa\u672c\u4fe1\u606f"}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u8fc7\u4ee5\u4e0b Demo \u53ef\u4ee5\u6267\u884c\u547d\u4ee4\uff0c\u89e3\u6790\u4e00\u4e0b Demo \u4e2d\u5404\u4e2a\u90e8\u5206\u7684\u4f5c\u7528"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public class Test {\n    public static void main(String[] args) throws Exception {\n        Interpreter interpreter = new Interpreter();\n\n        String func = "exec(Object cmd){java.lang.Runtime.getRuntime().exec(cmd);}";\n        interpreter.eval(func);\n\n        String payload = "exec(poc)";\n        interpreter.set("poc", "open -a Calculator.app");\n        interpreter.eval(payload);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"bshinterpreter",children:"bsh.Interpreter"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"bsh.Interpreter"})," \u662f\u811a\u672c\u89e3\u91ca\u5668\uff0c\u63d0\u4f9b\u4e86\u6267\u884c BeanShell \u811a\u672c\u7684\u529f\u80fd\uff0c\u901a\u8fc7 ",(0,r.jsx)(n.code,{children:"eval()"})," \u65b9\u6cd5\u7528\u4e8e\u6267\u884c\u7ed9\u5b9a\u7684 BeanShell \u8868\u8fbe\u5f0f\u6216\u8bed\u53e5\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"bshnamespace",children:"bsh.NameSpace"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"set()"})," \u65b9\u6cd5\u7528\u4e8e\u8bbe\u7f6e\u53d8\u91cf\u6216\u5c5e\u6027\u503c\uff0c\u4fdd\u5b58\u5728 ",(0,r.jsx)(n.code,{children:"bsh.NameSpace"})," \u4e2d\uff0c\u8fd9\u4e2a\u53d8\u91cf\u7528\u4e8e\u7ba1\u7406\u89e3\u91ca\u5668\u7684\u53d8\u91cf\u3001\u51fd\u6570\u548c\u7c7b\u7684\u547d\u540d\u7a7a\u95f4\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240304170633768",src:s(1913).Z+"",width:"1862",height:"844"})}),"\n",(0,r.jsx)(n.h2,{id:"0x02-bshthis",children:"0x02 bsh.This"}),"\n",(0,r.jsxs)(n.p,{children:["\u800c ",(0,r.jsx)(n.code,{children:"bsh.NameSpace"})," \u548c ",(0,r.jsx)(n.code,{children:"bsh.Interpreter"})," \u5171\u540c\u6784\u6210 BeanShell \u7684\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff0c\u7528 ",(0,r.jsx)(n.code,{children:"bsh.This"})," \u7c7b\u8868\u793a\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"bsh.XThis"})," \u662f\u5176\u5b50\u7c7b\uff0c ",(0,r.jsx)(n.code,{children:"invokeMethod()"})," \u65b9\u6cd5\u63d0\u4f9b\u4e86\u4ece\u811a\u672c\u4e2d\u8c03\u7528\u65b9\u6cd5\u7684\u80fd\u529b\uff0c\u4e0a\u6587\u7684\u4f8b\u5b50\u8f6c\u5316\u4e3a\u901a\u8fc7 ",(0,r.jsx)(n.code,{children:"XThis"})," \u6765\u6267\u884c\u5982\u4e0b\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'Interpreter interpreter = new Interpreter();\nString func = "exec(Object cmd){java.lang.Runtime.getRuntime().exec(cmd);}";\ninterpreter.eval(func);\nXThis xThis = new XThis(interpreter.getNameSpace(), interpreter);\nxThis.invokeMethod("exec", new Object[]{"open -a Calculator.app"});\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"bsh.XThis"})," \u53c8\u4e00\u4e2a\u5185\u90e8 ",(0,r.jsx)(n.code,{children:"Handler"})," \u7c7b\u5b9e\u73b0\u4e86\u52a8\u6001\u4ee3\u7406\uff0c\u5e76\u4e14\u8c03\u7528\u4e86 ",(0,r.jsx)(n.code,{children:"invokeImpl()"})," \u65b9\u6cd5"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240305115459051",src:s(97795).Z+"",width:"1470",height:"414"})}),"\n",(0,r.jsxs)(n.p,{children:["\u800c ",(0,r.jsx)(n.code,{children:"invokeImpl()"})," \u65b9\u6cd5\u4e2d\u901a\u8fc7 ",(0,r.jsx)(n.code,{children:"invokeMethod()"})," \u6267\u884c\u4e86\u65b9\u6cd5\uff0c\u6240\u4ee5\u4e0e Jython \u7684\u8c03\u7528\u94fe\u7c7b\u4f3c\uff0c\u540c\u6837\u53ef\u4ee5\u7528 ",(0,r.jsx)(n.code,{children:"Comparator"})," \u6765\u89e6\u53d1\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240305115408537",src:s(63725).Z+"",width:"2078",height:"1266"})}),"\n",(0,r.jsx)(n.h2,{id:"0x03-beanshell1-userdir-\u6cc4\u9732",children:"0x03 BeanShell1 user.dir \u6cc4\u9732"}),"\n",(0,r.jsxs)(n.p,{children:["BeanShell1 \u8fd9\u6761\u8c03\u7528\u94fe\u5728\u751f\u6210\u65f6\u4f1a\u6cc4\u9732\u6587\u4ef6\u8def\u5f84\uff0c\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0 ",(0,r.jsx)(n.a,{href:"https://mp.weixin.qq.com/s/CQ-jlcb3w72OP5UyGynMHg",children:"https://mp.weixin.qq.com/s/CQ-jlcb3w72OP5UyGynMHg"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"Interpreter"})," \u5bf9\u8c61\u521d\u59cb\u5316\u65f6\uff0c\u4f1a\u8c03\u7528 ",(0,r.jsx)(n.code,{children:"bsh.Interpreter.initRootSystemObject()"})," \u65b9\u6cd5\uff0c\u5c06 ",(0,r.jsx)(n.code,{children:"user.dir"})," \u8d4b\u503c\u7ed9 ",(0,r.jsx)(n.code,{children:"bsh.cwd"})," \u5c5e\u6027\uff0c\u907f\u514d\u8fd9\u4e2a\u6cc4\u9732\u9700\u8981\u53cd\u5c04\u4fee\u6539\u8be5\u503c"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240305140440895",src:s(26778).Z+"",width:"1336",height:"290"})})]})}function o(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},1913:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/image-20240304170633768-47b64f144d2d6cbd97821535c8e5d739.png"},63725:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/image-20240305115408537-9b266a50aa8320d82a3777b4dd0a7a30.png"},97795:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/image-20240305115459051-95e15d1fd62331432d7c2c7f46277a3b.png"},26778:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/image-20240305140440895-13c0f033802e9da4facbf757bdfed76a.png"},11151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>t});var r=s(67294);const i={},a=r.createContext(i);function t(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);